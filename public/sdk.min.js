class BadLabsSDK {
  constructor({ product: e, creatorStakeKey: t }) {
    ;(this.product = e),
      (this.creatorStakeKey = t),
      (this.frontUrl = 'https://labs.badfoxmc.com/sdk'),
      (this.supportedWallets = ['begin', 'eternl', 'flint', 'lace', 'nami', 'nufi', 'gerowallet', 'typhoncip30', 'vespr'])
  }
  loadWallets = async (e) => {
    let { injectId: t, buttonBackgroundColor: r = '#f5f5f5', buttonTextColor: i = '#000000' } = e || {}
    if (!this.product || !this.creatorStakeKey)
      throw Error('400 BAD REQUEST; missing required params; new BadLabsSDK({ product: "string", creatorStakeKey: "string" })')
    if (!['giveaways'].includes(this.product)) throw Error('400 BAD REQUEST; "product" must be one of ["giveaways"]')
    if (!t) throw Error('400 BAD REQUEST; missing required params; sdk.loadWallets({ injectId: "string" })')
    let a = window?.cardano || {},
      s = this.supportedWallets
        .filter((e) => void 0 !== a[e])
        .map((e) => ({ name: a[e].name, icon: a[e].icon, version: a[e].apiVersion, apiName: e })),
      n = document.getElementById(t)
    n.innerText = ''
    let d = document.createElement('div')
    s.forEach((e) => {
      let t = document.createElement('img')
      ;(t.src = e.icon), (t.style = 'width: 30px; height: 30px; margin: 0.5rem;')
      let a = document.createElement('span')
      a.innerText = e.name
      let s = document.createElement('button')
      ;(s.style = `width: 150px; margin: 0.1rem; white-space: nowrap; color: ${i}; background-color: ${r}; border: none; border-radius: 0.5rem; display: flex; align-items: center;`),
        s.appendChild(t),
        s.appendChild(a),
        (s.onclick = async () => {
          await this.connectAndStart(e.apiName), (n.innerText = '')
        }),
        d.appendChild(s)
    }),
      n.appendChild(d)
  }
  connectAndStart = async (e) => {
    let t = window?.cardano[e]
    if (t) {
      let r = await t.enable(),
        i = await r.getRewardAddresses()
      this.start({ userStakeKey: i[0] })
    } else window.alert(`${e} not installed`)
  }
  start({ userStakeKey: e } = {}) {
    if (!document || !document.body) throw Error('document.body is not defined')
    if (!e) throw Error('400 BAD REQUEST; missing required params; sdk.start({ userStakeKey: "string" })')
    let t = `?product=${this.product}&creator_stake_key=${this.creatorStakeKey}&user_stake_key=${e}`,
      r = this.frontUrl + t,
      i = window.innerWidth <= 768
    ;(this.iFrameWrapper = document.createElement('div')),
      this.iFrameWrapper.setAttribute('id', `bad-labs-${this.product}-iframe-wrapper`),
      this.iFrameWrapper.setAttribute(
        'style',
        'width: 100vw; height: 100vh; background-color: rgba(0, 0, 0, 0.5); border: none; display: flex; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; z-index: 999999'
      ),
      (this.iFrame = document.createElement('iframe')),
      this.iFrame.setAttribute('id', `bad-labs-${this.product}-iframe`),
      this.iFrame.setAttribute('src', r),
      this.iFrame.setAttribute(
        'style',
        `max-width: ${i ? '100vw' : '800px'}; width: 100%; max-height: ${i ? '100vh' : '70vh'}; height: 100%; border: none; border-radius: ${
          i ? '0' : '1rem'
        }; box-shadow: 0 0 2px #fff;`
      ),
      (this.iFrame = this.iFrameWrapper.appendChild(this.iFrame)),
      (this.iFrameWrapper = document.body.appendChild(this.iFrameWrapper)),
      window.addEventListener('message', ({ origin: e, data: t }) => {
        'close-bad-labs-sdk' === t && this.stop()
      })
  }
  stop() {
    ;(this.iFrame = this.iFrameWrapper.removeChild(this.iFrame)), (this.iFrameWrapper = document.body.removeChild(this.iFrameWrapper))
  }
}
